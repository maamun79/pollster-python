{% extends 'base.html' %}

{% block content %}
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <h1 class="text-center mb-5">{{ question.question_text }}</h1>
    <ul class="list-group mb-5">
        {% for choice in question.choice_set.all %}
            <li class="list-group-item">
                {{ choice.choice_text}} <span class="badge badge-success float-right"> {{ choice.votes }} vote{{ choice.votes | pluralize}}</span>
            </li>
        {% endfor %}
    </ul>
    <a href="{% url 'polls:index'%}" class="btn btn-secondary">Back to polls</a>
    <a href="{% url 'polls:detail' question.id %}" class="btn btn-dark">Vote again?</a>

<!--    Showing results in barchart-->
    <div class="card text-center mt-5 mb-5">
        <div class="card-body">
            <div id="myChart"></div>
        </div>
    </div>

    <script>
          var state = {
            "items": [],
            "values": []
          }
          var questionId = "{{question.id}}"
          var dataURL = `/polls/resultsdata/${questionId}/`

          $.ajax({
            method: "GET",
            url: dataURL,
            success:function(response){
                console.log(response)
                for(var i in response){
                    var key = Object.keys(response[i])[0]
                    var value = Object.values(response[i])[0]

                    state.items.push(key)
                    state.values.push(value)
                }
                buildChart()
            }
          });

          function buildChart(){
                var chartData = {
                    "type" : "bar3d",
                    "scale-x" : {
                        "values" : state.items
                    },
                    "series" : [
                        {
                            "values" : state.values
                        }
                    ]
                }
                zingchart.render({
                    id: 'myChart',
                    data: chartData
                });
          }
    </script>
{% endblock %}